<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../../template/HomeTemplate.xhtml">

            <ui:define name="content">
                <h1></h1>
                <h3>SERVICIOS</h3>
                <h3></h3>
                <h:form>
                    <h:panelGrid width="1313px" style="margin: 0 auto;">
                        <p:commandButton value="Crear Servicio" style="font-family: sans-serif; font-size: 22px; width: 232px; height: 55px; color: coral" action="#{servicioBean.enableBoton()}" oncomplete="PF('dialogCrearServicio').show();" update=":formCrearServicio :formMostrarServicios:tableServicios">
                            <f:actionListener binding="#{servicioBean.numeracionServicio()}"/> <f:actionListener binding="#{servicioBean.limpiarCamposServicio()}"/>
                        </p:commandButton>
                    </h:panelGrid>
                </h:form>
                <h1></h1>

                <h:form id="formMostrarServicios">
                    <p:dataTable id="tableServicios" value="#{servicioBean.listaServicios}" var="ser" emptyMessage="Sin Registros Guardados" style="align-content:center; margin-left:auto; margin-right:auto; font-style:initial; font-family:sans-serif; font-size:15px" rows="5" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15">
                        <p:column headerText="PLaca" filterBy="#{ser.placa}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width:180px">
                            <h:outputText value="#{ser.placa}"/>
                        </p:column>
                        <p:column headerText="Moto" style="text-align:center">
                            <h:outputText value="#{servicioBean.getmostrarMoto(ser.idMoto)}"/>
                        </p:column>
                        <p:column headerText="C.C CLiente" filterBy="#{ser.identificacionPersona}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width:180px">
                            <h:outputText value="#{servicioBean.getmostrarPersona(ser.idPersona)}"/>
                        </p:column>
                        <p:column headerText="Mecánico" style="text-align:center">
                            <h:outputText value="#{servicioBean.getmostrarMecanico(ser.idMecanico)}"/>
                        </p:column>
                        <p:column headerText="Observación" style="text-align:center">
                            <p:outputLabel value="#{ser.observacionServicio}">
                                <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                            </p:outputLabel>
                        </p:column>
                        <p:column headerText="Servicio" style="text-align:center">
                            <p:outputLabel value="#{ser.totalServicio}">
                                <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                            </p:outputLabel>
                        </p:column>
                        <p:column headerText="Acción" style="text-align:center; font-size:13px">
                            <p:commandButton value="#{ser.estadoServicio eq '0' ? 'Inactivo' : 'Activo'}" action="#{servicioBean.enableModificarServicio()}" oncomplete="PF('dialogModificarServicio').show();" update=":formModificarServicio" style="text-align:center; font-size:11px">
                                <f:param name="idServicioi" value="#{ser.idServicio}"/>
                                <f:param name="estServicioi" value="#{ser.estadoServicio}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:form>

                <h:form id="formCrearServicio">
                    <p:growl id="mensajesServicio" autoUpdate="true" showDetail="true" life="1500"/>
                    <p:dialog id="dlgCrearServicio" header="Información Servicio" widgetVar="dialogCrearServicio" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:layout id="layoutFacturaServicio" style="width: 100%; height: 137px">
                            <p:layoutUnit id="layoutServicio" position="center" style="padding: 5px; text-align: justify; font-size: 15px; size: 300px">
                                <h:panelGrid id="gridBuscarCliPro" columns="8">
                                    <p:outputLabel value="Cliente: " style="font-size: 16px; font-weight: bold"/>
                                    <p:inputText id="inpTexCliente" value="#{servicioBean.identificacionPersona}" size="23" placeholder="Ingrese C.C o Nit" converter="#{Integer}" converterMessage="Valor Erroneo" disabled="#{!servicioBean.enabled}" style="text-align: center; width: 333px">
                                        <p:ajax event="keyup" delay="500" listener="#{servicioBean.agregarDatosPersonaPorIdentificacion()}" update=":formCrearServicio:gridDatosCliente :formCrearServicio:inpTexCliente"/>
                                    </p:inputText>
                                    <p:commandButton value="+" oncomplete="PF('dialogDatosClientes').show();" update=":formCrearServicio:dialogClientes" disabled="#{!servicioBean.enabled}"/>
                                    <p:outputLabel value="Pago: " style="font-size: 16px; font-weight: bold"/>
                                    <p:inputText id="inpTexFormaPago" size="20" placeholder="Credito/Contado" converter="#{Integer}" converterMessage="Valor Erroneo" disabled="#{!servicioBean.enabled}" style="text-align: center"></p:inputText>
                                    <p:commandButton value="" disabled="#{!servicioBean.enabled}"/>
                                    <p:outputLabel value="Fecha: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel value="#{servicioBean.fechaSistema}"/>
                                </h:panelGrid>
                                <h:panelGrid id="gridDatosCliente" columns="10">
                                    <p:outputLabel value="Nombres: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="nombresCliente" value="#{servicioBean.persona.nombresPersona}"/>
                                    <p:outputLabel value="Apellidos: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="apellidosCliente" value="#{servicioBean.persona.apellidosPersona}"/>
                                    <p:outputLabel value="Teléfono: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="telefonoCliente" value="#{servicioBean.persona.telefonoPersona}"/>
                                </h:panelGrid>
                                <h:panelGrid id="gridBuscarMecPro" columns="8">
                                    <p:outputLabel value="Mecánico: " style="font-size: 16px; font-weight: bold"/>
                                    <p:inputText id="inpTexMecanico" value="#{servicioBean.identificacionMecanico}" size="23" placeholder="Ingrese Mecánico" converter="#{Integer}" converterMessage="Valor Erroneo" disabled="#{!servicioBean.enabled}" style="text-align: center; width: 333px">
                                        <p:ajax event="keyup" delay="500" listener="#{servicioBean.agregarDatosMecanicoPorIdentificacion()}" update=":formCrearServicio:gridDatosMecanico :formCrearServicio:inpTexMecanico"/>
                                    </p:inputText>
                                    <p:commandButton value="+" oncomplete="PF('dialogDatosMecanicos').show();" update=":formCrearServicio:dialogMecanicos" disabled="#{!servicioBean.enabled}"/>
                                    <p:outputLabel value="Placa: " style="font-size: 16px; font-weight: bold"/>
                                    <p:inputText id="inpTexPlaca" value="#{servicioBean.servicio.placa}" size="18" placeholder="Ingrese PLACA" disabled="#{!servicioBean.enabled}" style="text-align: center; width: 151px; text-transform: uppercase">
                                    </p:inputText>
                                    <p:commandButton value="" disabled="#{!servicioBean.enabled}"/>
                                    <p:outputLabel value="Moto: " style="font-size: 16px; font-weight: bold"/>
                                    <p:selectOneMenu value="#{servicioBean.servicio.idMoto}" style="width: 202px">
                                        <f:selectItem noSelectionOption="true" itemLabel="SELECCIONE" itemValue="#{null}"/>
                                        <f:selectItems value="#{motoBean.listaMotos}" var="mot" itemLabel="#{mot.nombreMoto}" itemValue="#{mot.idMoto}"/>
                                    </p:selectOneMenu>
                                </h:panelGrid>
                                <h:panelGrid id="gridDatosMecanico" columns="10">
                                    <p:outputLabel value="Nombres: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="nombresMecanico" value="#{servicioBean.mecanico.nombresMecanico}"/>
                                    <p:outputLabel value="Apellidos: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="apellidosMecanico" value="#{servicioBean.mecanico.apellidosMecanico}"/>
                                    <p:outputLabel value="Teléfono: " style="font-size: 16px; font-weight: bold"/>
                                    <p:outputLabel id="telefonoMecanico" value="#{servicioBean.mecanico.telefonoMecanico}"/>
                                </h:panelGrid>
                            </p:layoutUnit>
                            <p:layoutUnit id="layoutNumeroFactura" position="east" style=" padding: 35px; text-align: center; font-size: 33px" size="150">
                                <h:panelGrid columns="1" style="font-size: 30px; font-weight: normal; margin-top: 30px; margin: 0 auto">
                                    <h6>Green Apps</h6>
                                </h:panelGrid>
                            </p:layoutUnit>
                        </p:layout>
                        <h1></h1>
                        <h:panelGrid id="gridBuscarServicio" columns="1">
                            <p:outputLabel value="Observación" style="font-size: 16px; font-weight: bold"/>
                            <p:inputText id="inpTexObservacion" value="#{servicioBean.servicio.observacionServicio}" size="118" placeholder="Ingrese Observación" disabled="#{!servicioBean.enabled}" style="text-align: center; text-transform: uppercase">
                            </p:inputText>
                            <p:commandButton value="" disabled="#{!servicioBean.enabled}"/>
                            <p:outputLabel value="Código de Producto" style="font-size: 16px; font-weight: bold"/>
                            <p:inputText id="inpTexProducto" value="#{servicioBean.codigoProducto}" size="27" placeholder="Digite Código Producto" disabled="#{!servicioBean.enabled}" style="text-align: center; text-transform: uppercase">
                                <p:ajax event="keyup" delay="500" listener="#{servicioBean.mostrarDatosCantidadProductoPorCodigo()}" update=":formCrearServicio:gridBuscarServicio"/>
                            </p:inputText>
                            <p:commandButton value="+" oncomplete="PF('dialogDatosProductos').show();" update=":formCrearServicio:dialogProductos" disabled="#{!servicioBean.enabled}"/>
                        </h:panelGrid>
                        <p:dataTable id="tableProductoFactura" editable="true" value="#{servicioBean.listaDetalleServicio}" var="pro" rowIndexVar="rowIndex">
                            <p:ajax event="rowEdit" listener="#{servicioBean.onRowEdit}" update=":formCrearServicio:tableProductoFactura :formCrearServicio:gridTotalFactura"/>
                            <p:ajax event="rowEditCancel" listener="#{servicioBean.onRowCancel}" update=":formCrearServicio:tableProductoFactura :formCrearServicio:gridTotalFactura"/>
                            <p:column headerText="Código">
                                <h:outputText value="#{pro.codigoProducto}"/>
                            </p:column>
                            <p:column headerText="Producto">
                                <h:outputText value="#{pro.nombreProducto}"/>
                            </p:column>
                            <p:column headerText="Valor Venta">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="$ #{pro.valorVentaProducto}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <h:inputText value="#{pro.valorVentaProducto}" required="true" requiredMessage="Digite un Valor Numérico" converter="#{Integer}" converterMessage="Valor Erroneo" validatorMessage="Valor Erroneo">
                                            <f:validateLongRange minimum="1"/>
                                        </h:inputText>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="IVA">
                                <h:outputText value="#{pro.iva}"/>
                            </p:column>
                            <p:column headerText="Unidades">
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{pro.unidadesVendidas}"/>
                                    </f:facet>
                                    <f:facet name="input">
                                        <h:inputText value="#{pro.unidadesVendidas}" required="true" requiredMessage="Digite un Valor Numérico" converter="#{Integer}" converterMessage="Valor Erroneo" validatorMessage="Valor Erroneo">
                                            <f:validateLongRange minimum="1"/>
                                        </h:inputText>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column headerText="Total">
                                <p:outputLabel value="#{pro.totalDetalleServicio}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Eliminar" style="width:88px">
                                <p:commandLink value=" X" style="font-size: 22px ; text-decoration: none ; color: red" actionListener="#{servicioBean.eliminarProducto(pro.codigoProducto, rowIndex)}" update=":formCrearServicio:tableProductoFactura :formCrearServicio:gridTotalFactura"/>
                                <p:rowEditor/>
                            </p:column>
                        </p:dataTable>
                        <h:panelGrid id="gridTotalFactura" columns="2" style="font-size: 15px; margin: 0 auto">
                            <h3>Total Servicio</h3>
                            <p:outputLabel value="#{servicioBean.totalServicioFacturaServicio}" style="font-size: 27px; margin: 0 auto">
                                <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                            </p:outputLabel>
                        </h:panelGrid>
                        <h6></h6>
                        <p:commandButton value="Aceptar" style="width: 200px; height: 38px" oncomplete="PF('dialogDatosConfirmarGuardarServicio').show();" update=":formCrearServicio:dialogConfirmarGuardarServicio" disabled="#{!servicioBean.enabled}"/>
                        <h:commandLink id="linkImprimir" actionListener="#{servicioBean.reporteImpresionFacturaServicio()}" target="_blank" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"><p:graphicImage url="/imgs/imprimirIcono.png"/></h:commandLink>
                        <p:commandButton value="Editar" style="width: 100px; height: 38px; color: coral" actionListener="#{servicioBean.editarServicioFULL()}" update=":formCrearServicio :formMostrarServicios:tableServicios" oncomplete="PF('dialogNuevoServicio').hide();" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"/>
                        <p:commandButton value="Cancelar" style="width: 111px; height: 38px" actionListener="#{servicioBean.limpiarFacturaServicio()}" update=":formCrearServicio" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"/>
                    </p:dialog>
                    <p:dialog id="dialogClientes" widgetVar="dialogDatosClientes" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:dataTable id="tablePersonas" value="#{personaBean.listaPersonas}" var="per" emptyMessage="Sin Registros Guardados" style="align-content:center; margin-left:auto; margin-right:auto; font-style:initial; font-family:sans-serif; font-size:15px" rows="5" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15">
                            <p:column headerText="Documento" style="text-align:center">
                                <h:outputText value="#{personaBean.getmostrarTipoDocumento(per.idTipoDocumento)}"/>
                            </p:column>
                            <p:column headerText="Identificación" filterBy= "#{per.identificacionPersona}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width: 180px">
                                <h:outputText value="#{per.identificacionPersona}"/>
                            </p:column>
                            <p:column headerText="Nombres" style="text-align:center">
                                <h:outputText value="#{per.nombresPersona}"/>
                            </p:column>
                            <p:column headerText="Apellidos" style="text-align:center">
                                <h:outputText value="#{per.apellidosPersona}"/>
                            </p:column>
                            <p:column headerText="Departamento" style="text-align:center">
                                <h:outputText value="#{personaBean.getmostrarDepartamento(per.idDepartamento)}"/>
                            </p:column>
                            <p:column headerText="Ciudad" style="text-align:center">
                                <h:outputText value="#{personaBean.getmostrarCiudad(per.idCiudad)}"/>
                            </p:column>
                            <p:column headerText="Dirección" style="text-align:center">
                                <h:outputText value="#{per.direccionPersona}"/>
                            </p:column>
                            <p:column headerText="Teléfono" style="text-align:center">
                                <h:outputText value="#{per.telefonoPersona}"/>
                            </p:column>
                            <p:column headerText="Email" style="text-align:center">
                                <h:outputText value="#{per.correoPersona}"/>
                            </p:column>
                            <p:column headerText="Seleccione" style="text-align:center; font-size:13px">
                                <p:commandButton value="Seleccionar" actionListener="#{servicioBean.agregarDatosPersona(per.idPersona)}" oncomplete="PF('dialogDatosClientes').hide();" update=":formCrearServicio:gridDatosCliente"/>
                            </p:column>
                        </p:dataTable>
                        <h6></h6><p:commandButton value="Cancelar" oncomplete="PF('dialogDatosClientes').hide();"/>
                    </p:dialog>
                    <p:dialog id="dialogMecanicos" widgetVar="dialogDatosMecanicos" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:dataTable id="tableMecanicos" value="#{mecanicoBean.listaMecanicos}" var="mec" emptyMessage="Sin Registros Guardados" style="align-content:center; margin-left:auto; margin-right:auto; font-style:initial; font-family:sans-serif; font-size:15px" rows="5" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15">
                            <p:column headerText="Identificación" filterBy= "#{mec.identificacionMecanico}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width: 180px">
                                <h:outputText value="#{mec.identificacionMecanico}"/>
                            </p:column>
                            <p:column headerText="Nombres" style="text-align:center">
                                <h:outputText value="#{mec.nombresMecanico}"/>
                            </p:column>
                            <p:column headerText="Apellidos" style="text-align:center">
                                <h:outputText value="#{mec.apellidosMecanico}"/>
                            </p:column>
                            <p:column headerText="Departamento" style="text-align:center">
                                <h:outputText value="#{mecanicoBean.getmostrarDepartamento(mec.idDepartamento)}"/>
                            </p:column>
                            <p:column headerText="Ciudad" style="text-align:center">
                                <h:outputText value="#{mecanicoBean.getmostrarCiudad(mec.idCiudad)}"/>
                            </p:column>
                            <p:column headerText="Dirección" style="text-align:center">
                                <h:outputText value="#{mec.direccionMecanico}"/>
                            </p:column>
                            <p:column headerText="Teléfono" style="text-align:center">
                                <h:outputText value="#{mec.telefonoMecanico}"/>
                            </p:column>
                            <p:column headerText="Email" style="text-align:center">
                                <h:outputText value="#{mec.correoMecanico}"/>
                            </p:column>
                            <p:column headerText="Seleccione" style="text-align:center; font-size:13px">
                                <p:commandButton value="Seleccionar" actionListener="#{servicioBean.agregarDatosMecanico(mec.idMecanico)}" oncomplete="PF('dialogDatosMecanicos').hide();" update=":formCrearServicio:gridDatosMecanico"/>
                            </p:column>
                        </p:dataTable>
                        <h6></h6><p:commandButton value="Cancelar" oncomplete="PF('dialogDatosMecanicos').hide();"/>
                    </p:dialog>
                    <p:dialog id="dialogProductos" widgetVar="dialogDatosProductos" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:dataTable id="tableProductos" value="#{productoBean.listaProductos}" var="pro" emptyMessage="Sin Registros Guardados" style="align-content:center; margin-left:auto; margin-right:auto; font-style:initial; font-family:sans-serif; font-size:15px" rows="5" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" rowStyleClass="${pro.stockProducto lt pro.stockMinimo ? 'red-row' : (pro.stockProducto == pro.stockMinimo ? 'orange-row' : '')}">
                            <p:column headerText="Código" filterBy= "#{pro.codigoProducto}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width: 180px">
                                <h:outputText value="#{pro.codigoProducto}"/>
                            </p:column>
                            <p:column headerText="Producto" style="text-align:center">
                                <h:outputText value="#{pro.nombreProducto}"/>
                            </p:column>
                            <p:column headerText="Descripción" filterBy= "#{pro.descripcionProducto}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center;width: 180px">
                                <h:outputText value="#{pro.descripcionProducto}"/>
                            </p:column>
                            <p:column headerText="Stock" style="text-align:center">
                                <h:outputText value="#{pro.stockProducto}"/>
                            </p:column>
                            <p:column headerText="Valor Compra" style="text-align:center">
                                <p:outputLabel value="#{pro.valorCompraProducto}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Valor Venta" style="text-align:center">
                                <p:outputLabel value="#{pro.valorVentaProducto}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="IVA" style="text-align:center">
                                <h:outputText value="#{pro.iva}"/>
                            </p:column>
                            <p:column headerText="Categoría" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarCategoria(pro.idCategoria)}"/>
                            </p:column>
                            <p:column headerText="Presentación" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarPresentacionProducto(pro.idPresentacionProducto)}"/>
                            </p:column>
                            <p:column headerText="Ubicación" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarUbicacionProducto(pro.idUbicacionProducto)}"/>
                            </p:column>
                            <p:column headerText="Seleccione" style="text-align:center; font-size:11px">
                                <p:commandButton value="Seleccionar" actionListener="#{servicioBean.solicitarCantidadProducto(pro.codigoProducto)}" oncomplete="PF('dialogDatosCantidadProductoPorCodigo').show();" update=":formCrearServicio:dialogCantidadProductoPorCodigo"/>
                            </p:column>
                        </p:dataTable>
                        <h6></h6><p:commandButton value="Cancelar" oncomplete="PF('dialogDatosProductos').hide();"/>
                    </p:dialog>
                    <p:dialog id="dialogCantidadProductoPorCodigo" widgetVar="dialogDatosCantidadProductoPorCodigo" header="Cantidad" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:inputText id="inpTexCantidadProducto" value="#{servicioBean.unidadesVendidas}" placeholder="Digite una Cantidad" style="text-align:center"/>
                        <p:commandButton value="Aceptar" actionListener="#{servicioBean.agregarDatosProductoPorCodigoProducto()}" oncomplete="PF('dialogDatosCantidadProductoPorCodigo').hide(); PF('dialogDatosProductos').hide();" update=":formCrearServicio:tableProductoFactura :formCrearServicio:dialogCantidadProductoPorCodigo :formCrearServicio:gridTotalFactura"/>
                    </p:dialog>
                    <p:dialog id="dialogCantidadProductoPorCodigoRead" widgetVar="dialogDatosCantidadProductoPorCodigoRead" header="Cantidad" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:inputText id="inpTexCantidadProductoPorCodigo" value="#{servicioBean.unidadesVendidasPorCodigo}" placeholder="Digite una Cantidad" style="text-align:center"/>
                        <p:commandButton value="Aceptar" actionListener="#{servicioBean.agregarDatosProductoPorCodigoProductoRead()}" oncomplete="PF('dialogDatosCantidadProductoPorCodigoRead').hide();" update=":formCrearServicio:tableProductoFactura :formCrearServicio:dialogCantidadProductoPorCodigoRead :formCrearServicio:gridTotalFactura"/>
                    </p:dialog>
                    <p:dialog id="dialogConfirmarGuardarServicio" widgetVar="dialogDatosConfirmarGuardarServicio" header="¿Desea Finalizar Servicio?" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:commandButton value="Si" style="color: red" actionListener="#{servicioBean.ingresarServicioFULL()}" update=":formCrearServicio :formMostrarServicios:tableServicios" oncomplete="PF('dialogDatosConfirmarGuardarServicio').hide(); PF('dialogNuevoServicio').hide();" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"/>
                        <p:commandButton value="No" oncomplete="PF('dialogDatosConfirmarGuardarServicio').hide();"/>
                    </p:dialog>
                </h:form>

                <h:form id="formModificarServicio">
                    <p:growl id="mensajesServicio" autoUpdate="true" showDetail="true" life="1500"/>
                    <p:dialog id="dlgModificarServicio" header="Información Servicio" widgetVar="dialogModificarServicio" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:layout id="layoutFacturaServicio" style="width: 100%; height: 52px">
                            <p:layoutUnit id="layoutServicio" position="center" style="padding: 5px; text-align: justify; font-size: 15px; size: 300px">
                                <h:panelGrid id="gridBuscarCliPro" columns="8">
                                    <p:outputLabel value="Cliente:" style="font-size: 16px; font-weight: bold"/>
                                    <p:selectOneMenu value="#{servicioBean.servicio.idPersona}" disabled="#{!servicioBean.enabled}" style="width: 212px">
                                        <f:selectItem noSelectionOption="true" itemLabel="SELECCIONE" itemValue="#{null}"/>
                                        <f:selectItems value="#{personaBean.listaPersonas}" var="ser" itemLabel="#{ser.nombresPersona}" itemValue="#{ser.idPersona}"/>
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Mecánico:" style="font-size: 16px; font-weight: bold"/>
                                    <p:selectOneMenu value="#{servicioBean.servicio.idMecanico}" disabled="#{!servicioBean.enabled}" style="width: 212px">
                                        <f:selectItem noSelectionOption="true" itemLabel="SELECCIONE" itemValue="#{null}"/>
                                        <f:selectItems value="#{mecanicoBean.listaMecanicos}" var="ser" itemLabel="#{ser.nombresMecanico}" itemValue="#{ser.idMecanico}"/>
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Moto:" style="font-size: 16px; font-weight: bold"/>
                                    <p:selectOneMenu value="#{servicioBean.servicio.idMoto}" disabled="#{!servicioBean.enabled}" style="width: 202px">
                                        <f:selectItem noSelectionOption="true" itemLabel="SELECCIONE" itemValue="#{null}"/>
                                        <f:selectItems value="#{motoBean.listaMotos}" var="ser" itemLabel="#{ser.nombreMoto}" itemValue="#{ser.idMoto}"/>
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Placa:" style="font-size: 16px; font-weight: bold"/>
                                    <p:inputText value="#{servicioBean.servicio.placa}" disabled="#{!servicioBean.enabled}" style="width: 111px; text-align: center; text-transform: uppercase"/>
                                </h:panelGrid>
                            </p:layoutUnit>
                            <p:layoutUnit id="layoutNumeroFactura" position="east" style="text-align: center; padding-top: 4px; font-size: 15px" size="151">
                                <h:panelGrid columns="1" style="font-size: 22px; font-weight: bold; margin: 0 auto">
                                    <h6>SERVICIO</h6>
                                </h:panelGrid>
                            </p:layoutUnit>
                        </p:layout>
                        <h1></h1>
                        <h:panelGrid id="gridBuscarServicio" columns="1">
                            <p:outputLabel value="Observación" style="font-size: 16px; font-weight: bold"/>
                            <p:inputText id="inpTexObservacion" value="#{servicioBean.servicio.observacionServicio}" size="118" placeholder="Ingrese Observación" disabled="#{!servicioBean.enabled}" style="text-align: center; text-transform: uppercase">
                            </p:inputText>
                            <p:commandButton value="" disabled="#{!servicioBean.enabled}"/>
                            <p:outputLabel value="Código de Producto" style="font-size: 16px; font-weight: bold"/>
                            <p:inputText id="inpTexProducto" value="#{servicioBean.codigoProducto}" size="27" placeholder="Digite Código Producto" disabled="#{!servicioBean.enabled}" style="text-align: center; text-transform: uppercase">
                                <p:ajax event="keyup" delay="500" listener="#{servicioBean.mostrarDatosCantidadProductoModificadoPorCodigo()}" update= ":formModificarServicio:gridBuscarServicio "/>
                            </p:inputText>
                            <p:commandButton value="+" oncomplete="PF('dialogDatosProductos').show();" update=":formModificarServicio:dialogProductos" disabled="#{!servicioBean.enabled}"/>
                        </h:panelGrid>
                        <p:dataTable id="tableProductoFacturaModificada" editable="true" value="#{servicioBean.listaDetalleServicio}" var="pro" rowIndexVar="rowIndex">
                            <p:column headerText="Código">
                                <h:outputText value="#{pro.codigoProducto}"/>
                            </p:column>
                            <p:column headerText="Producto">
                                <h:outputText value="#{pro.nombreProducto}"/>
                            </p:column>
                            <p:column headerText="Valor Venta">
                                <p:outputLabel value="#{pro.valorVentaProducto}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="IVA">
                                <h:outputText value="#{pro.iva}"/>
                            </p:column>
                            <p:column headerText="Unidades">
                                <h:outputText value="#{pro.unidadesVendidas}"/>
                            </p:column>
                            <p:column headerText="Total">
                                <p:outputLabel value="#{pro.totalDetalleServicio}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Modificar" style="width:88px">
                                <p:commandButton value="Modificar" oncomplete="PF('dialogModificarProducto').show();" update=":formModificarProducto :formModificarServicio:tableProductoFacturaModificada :formModificarServicio:gridTotalFactura" disabled="#{!servicioBean.enabled}" style="text-align: center; font-size:11px" >
                                    <f:setPropertyActionListener target="#{servicioBean.detalleServicio}" value="#{pro}"/>
                                </p:commandButton>
                            </p:column>
                            <p:column headerText="Eliminar" style="width:88px">
                                <p:commandButton value="Eliminar" oncomplete="PF('dialogEliminarProducto').show();" actionListener="#{servicioBean.eliminarProducto(pro.codigoProducto, rowIndex)}" update=":formEliminarProducto :formModificarServicio:tableProductoFacturaModificada :formModificarServicio:gridTotalFactura" disabled="#{!servicioBean.enabled}" style="text-align: center; font-size:11px" >
                                    <f:setPropertyActionListener target="#{servicioBean.detalleServicio}" value="#{pro}"/>
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                        <h:panelGrid id="gridTotalFactura" columns="2" style="font-size: 15px; margin: 0 auto">
                            <h3>Total Servicio</h3>
                            <p:outputLabel value="#{servicioBean.totalServicioFacturaServicio}" style="font-size: 27px; margin: 0 auto">
                                <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                            </p:outputLabel>
                        </h:panelGrid>
                        <h6></h6>
                        <p:commandButton value="Aceptar" style="width: 200px; height: 38px" oncomplete="PF('dialogDatosConfirmarGuardarServicioModificado').show();" update=":formModificarServicio:dialogConfirmarGuardarServicioModificado" disabled="#{!servicioBean.enabled}"/>
                        <h:commandLink id="linkImprimir" actionListener="#{servicioBean.reporteImpresionFacturaServicioModificado(servicioBean.servicio.idServicio)}" target="_blank" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"><p:graphicImage url="/imgs/imprimirIcono.png"/></h:commandLink>
                        <p:commandButton value="Editar" style="width: 100px; height: 38px; color: coral" actionListener="#{servicioBean.editarServicioModificado()}" update=":formModificarServicio :formMostrarServicios:tableServicios" oncomplete="PF('dialogModificarServicio').hide();" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"/>
                        <p:commandButton value="Cancelar" style="width: 111px; height: 38px" actionListener="#{servicioBean.limpiarFacturaServicio()}" update=":formModificarServicio" action="#{servicioBean.disableBoton()}"/>
                    </p:dialog>
                    <p:dialog id="dialogProductos" widgetVar="dialogDatosProductos" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:dataTable id="tableProductos" value="#{productoBean.listaProductos}" var="pro" emptyMessage="Sin Registros Guardados" style="align-content:center; margin-left:auto; margin-right:auto; font-style:initial; font-family:sans-serif; font-size:15px" rows="5" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" rowStyleClass="${pro.stockProducto lt pro.stockMinimo ? 'red-row' : (pro.stockProducto == pro.stockMinimo ? 'orange-row' : '')}">
                            <p:column headerText="Código" filterBy= "#{pro.codigoProducto}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center; width: 180px; text-transform: uppercase">
                                <h:outputText value="#{pro.codigoProducto}"/>
                            </p:column>
                            <p:column headerText="Producto" style="text-align:center">
                                <h:outputText value="#{pro.nombreProducto}"/>
                            </p:column>
                            <p:column headerText="Descripción" filterBy= "#{pro.descripcionProducto}" filterStyle="width:150px; text-align:center" filterMatchMode="contains" style="text-align:center;width: 180px; text-transform: uppercase">
                                <h:outputText value="#{pro.descripcionProducto}"/>
                            </p:column>
                            <p:column headerText="Stock" style="text-align:center">
                                <h:outputText value="#{pro.stockProducto}"/>
                            </p:column>
                            <p:column headerText="Valor Compra" style="text-align:center">
                                <p:outputLabel value="#{pro.valorCompraProducto}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="Valor Venta" style="text-align:center">
                                <p:outputLabel value="#{pro.valorVentaProducto}">
                                    <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                                </p:outputLabel>
                            </p:column>
                            <p:column headerText="IVA" style="text-align:center">
                                <h:outputText value="#{pro.iva}"/>
                            </p:column>
                            <p:column headerText="Categoría" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarCategoria(pro.idCategoria)}"/>
                            </p:column>
                            <p:column headerText="Presentación" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarPresentacionProducto(pro.idPresentacionProducto)}"/>
                            </p:column>
                            <p:column headerText="Ubicación" style="text-align:center">
                                <h:outputText value="#{productoBean.getmostrarUbicacionProducto(pro.idUbicacionProducto)}"/>
                            </p:column>
                            <p:column headerText="Seleccione" style="text-align:center; font-size:11px">
                                <p:commandButton value="Seleccionar" actionListener="#{servicioBean.solicitarCantidadProducto(pro.codigoProducto)}" oncomplete="PF('dialogDatosCantidadProductoModificadoPorCodigo').show();" update=":formModificarServicio:dialogCantidadProductoModificadoPorCodigo"/>
                            </p:column>
                        </p:dataTable>
                        <h6></h6><p:commandButton value="Cancelar" oncomplete="PF('dialogDatosProductos').hide();"/>
                    </p:dialog>
                    <p:dialog id="dialogCantidadProductoModificadoPorCodigo" widgetVar="dialogDatosCantidadProductoModificadoPorCodigo" header="Cantidad" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:inputText id="inpTexCantidadProducto" value="#{servicioBean.unidadesVendidas}" placeholder="Digite una Cantidad" style="text-align:center"/>
                        <p:commandButton value="Aceptar" actionListener="#{servicioBean.agregarDatosProductoPorCodigoProductoModificado()}" oncomplete="PF('dialogDatosCantidadProductoModificadoPorCodigo').hide(); PF('dialogDatosProductos').hide();" update=":formModificarServicio:tableProductoFacturaModificada :formModificarServicio:dialogCantidadProductoModificadoPorCodigo :formModificarServicio:gridTotalFactura"/>
                    </p:dialog>
                    <p:dialog id="dialogCantidadProductoModificadoPorCodigoRead" widgetVar="dialogDatosCantidadProductoModificadoPorCodigoRead" header="Cantidad" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:inputText id="inpTexCantidadProductoPorCodigo" value="#{servicioBean.unidadesVendidasPorCodigo}" placeholder="Digite una Cantidad" style="text-align:center"/>
                        <p:commandButton value="Aceptar" actionListener="#{servicioBean.agregarDatosProductoModificadoPorCodigoProductoRead()}" oncomplete="PF('dialogDatosCantidadProductoModificadoPorCodigoRead').hide();" update=":formModificarServicio:tableProductoFacturaModificada :formModificarServicio:dialogCantidadProductoModificadoPorCodigoRead :formModificarServicio:gridTotalFactura"/>
                    </p:dialog>
                    <p:dialog id="dialogConfirmarGuardarServicioModificado" widgetVar="dialogDatosConfirmarGuardarServicioModificado" header="¿Desea Finalizar Servicio?" modal="true" resizable="true" showEffect="explode" hideEffect="explode" style="text-align:center">
                        <p:commandButton value="Si" style="color: red" actionListener="#{servicioBean.guardarServicioModificado()}" update=":formModificarServicio :formMostrarServicios:tableServicios" oncomplete="PF('dialogModificarServicio').hide();" disabled="#{!servicioBean.enabled}" action="#{servicioBean.disableBoton()}"/>
                        <p:commandButton value="No" oncomplete="PF('dialogDatosConfirmarGuardarServicioModificado').hide();"/>
                    </p:dialog>
                </h:form>

                <h:form id="formModificarProducto">
                    <p:dialog id="dlgModificarProducto" header="Modificar Producto" widgetVar="dialogModificarProducto" resizable="false" showEffect="explode" hideEffect="explode" modal="true">
                        <p:panelGrid columns="1" style="margin: 0 auto">
                            <p:outputLabel value="Código"/>
                            <p:outputLabel value="#{servicioBean.detalleServicio.codigoProducto}" style="text-align: center; color: activeborder"/>
                            <p:outputLabel value="Producto"/>
                            <p:outputLabel value="#{servicioBean.detalleServicio.nombreProducto}" style="text-align: center; color: activeborder"/>
                            <p:outputLabel value="Valor de Venta"/>
                            <p:inputText value="#{servicioBean.detalleServicio.valorVentaProducto}" size="9">
                                <f:convertNumber type="currency" currencySymbol="$ " minFractionDigits="0"/>
                            </p:inputText>
                            <p:outputLabel value="IVA"/>
                            <p:selectOneMenu value="#{servicioBean.detalleServicio.iva}">
                                <f:selectItem itemLabel="SI" itemValue="SI"/>
                                <f:selectItem itemLabel="NO" itemValue="NO"/>
                            </p:selectOneMenu>
                            <!--<p:outputLabel value="Unidades"/>
                            <p:inputText value="#{servicioBean.detalleServicio.unidadesVendidas}" size="3"/>-->
                        </p:panelGrid>
                        <p:commandButton value="Modificar" actionListener="#{servicioBean.editarDetalleServicioModificado()}" oncomplete="PF('dialogModificarProducto').hide();" update=":formModificarServicio:tableProductoFacturaModificada :formModificarServicio:gridTotalFactura"/>
                        <p:commandButton value="Cancelar" onclick="PF('dialogModificarProducto').hide();"/>
                    </p:dialog>
                </h:form>

                <h:form id="formEliminarProducto">
                    <p:dialog id="dlgEliminarProducto" header="Continuar" widgetVar="dialogEliminarProducto" resizable="false" showEffect="explode" hideEffect="explode" modal="true">
                        <p:commandButton value="Aceptar" actionListener="#{servicioBean.eliminarDetalleServicioModificado()}" oncomplete="PF('dialogEliminarProducto').hide();" update=":formModificarServicio:tableProductoFacturaModificada :formModificarServicio:gridTotalFactura"/>
                    </p:dialog>
                </h:form>

            </ui:define>

        </ui:composition>

    </body>
</html>